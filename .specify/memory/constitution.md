<!-- 
Sync Impact Report:
- Version change: Initial → 1.0.0
- New constitution created with 5 core principles
- Added sections: Code Quality Standards, API Design Standards
- Templates requiring updates: ⚠ All templates need initial review
- Follow-up TODOs: None
-->

# Partners Connect Server Constitution

## Core Principles

### I. Code Quality Standards (NON-NEGOTIABLE)
All code MUST adhere to ktlint formatting and detekt static analysis rules with zero violations. 
Every class, function, and property MUST have meaningful documentation. Code reviews MUST verify 
readability, maintainability, and adherence to Kotlin idioms. No exceptions will be made for 
technical debt without explicit architectural approval and remediation timeline.

**Rationale**: High code quality ensures long-term maintainability, reduces onboarding time, 
and prevents accumulation of technical debt in a complex partnership management system.

### II. Comprehensive Testing Strategy (NON-NEGOTIABLE)
Every new feature MUST include unit tests achieving minimum 80% code coverage. Integration tests 
MUST cover all external service interactions (Slack, Mailjet, BilletWeb, Google Cloud Storage). 
Database operations MUST be tested with H2 in-memory database. Test-driven development is 
STRONGLY ENCOURAGED for complex business logic.

**Rationale**: Partnership and billing operations require absolute reliability. Comprehensive 
testing prevents revenue-impacting bugs and ensures confidence in deployments.

### III. Clean Modular Architecture
Domain modules MUST remain decoupled with clear boundaries. Each module (auth, billing, companies, 
events, etc.) MUST expose well-defined interfaces and avoid circular dependencies. Shared 
infrastructure MUST be isolated in the internal/ module. Database schema changes MUST be 
backwards-compatible with migration strategy.

**Rationale**: Modular architecture enables independent development, testing, and deployment 
of features while maintaining system coherence and supporting team scalability.

### IV. API Consistency & User Experience
REST API endpoints MUST follow consistent naming conventions, HTTP status codes, and error 
response formats. All endpoints MUST include comprehensive OpenAPI documentation. Response 
times MUST not exceed 2 seconds for standard operations. User-facing error messages MUST 
be clear and actionable.

**Rationale**: Consistent APIs reduce integration complexity for frontend teams and external 
partners, while performance standards ensure responsive user experience.

### V. Performance & Observability Requirements
All database queries MUST be optimized with proper indexing and connection pooling. Application 
MUST emit structured logs with correlation IDs for request tracing. Performance metrics MUST 
be collected for all critical business operations. Resource usage MUST be monitored in production 
with alerting on thresholds.

**Rationale**: Partnership operations involve financial transactions and time-sensitive event 
management requiring high performance and comprehensive monitoring for operational excellence.

## Code Quality Standards

All code contributions MUST pass automated quality gates:
- ktlint formatting compliance (enforced in CI/CD)
- detekt static analysis with zero violations
- Minimum 80% test coverage for new code
- All public APIs documented with KDoc
- No TODO comments in production branches without GitHub issues

### Documentation Principles (CRITICAL)
Interface documentation MUST be comprehensive and serve as the single source of truth. Implementation 
classes MUST NOT duplicate interface documentation - they should only document implementation-specific 
details, design choices, or technical constraints not covered by the interface contract. This prevents 
documentation drift and reduces maintenance burden while keeping the interface as the authoritative 
contract documentation.

## API Design Standards

REST API design MUST follow these constraints:
- RESTful resource naming (plural nouns, clear hierarchies)
- Consistent error response format with error codes and messages
- Proper HTTP status codes (2xx success, 4xx client errors, 5xx server errors)
- Request/response validation with clear validation error messages
- Rate limiting implemented for all public endpoints
- Comprehensive OpenAPI/Swagger documentation maintained

### OpenAPI Documentation Requirements (CRITICAL)
All new or modified REST API endpoints MUST be documented in `server/application/src/main/resources/openapi/openapi.yaml`. 
The `documentation.yaml` file is auto-generated by Redocly CLI in CI/CD and MUST NOT be edited manually. 
Endpoint specifications MUST include complete parameter definitions, request/response schemas, error codes, 
and descriptive documentation. Header requirements (especially Accept-Language) MUST be accurately reflected 
with correct `required` flags.

### Exception Handling Pattern (CRITICAL)
Route handlers MUST NOT include try-catch blocks for exception-to-HTTP conversion. The Ktor 
StatusPages plugin handles all exception-to-HTTP response mapping automatically with consistent 
error formatting. Domain/repository layers SHOULD throw appropriate exceptions (NotFoundException, 
IllegalArgumentException, etc.) which StatusPages converts to proper HTTP responses. Manual 
exception handling in routes creates inconsistent error responses and duplicates functionality.

### Parameter Extraction Pattern (CRITICAL)
Route handlers MUST use the predefined StringValues extension functions for parameter extraction 
instead of manual null checks with custom exceptions. Use `call.parameters.eventSlug`, 
`call.parameters.orgSlug`, etc. These extensions automatically throw MissingRequestParameterException 
(handled by StatusPages as BadRequestException) when parameters are missing. NEVER throw 
IllegalArgumentException or other custom exceptions for missing parameters - this breaks the 
StatusPages exception handling contract and creates inconsistent error responses.

## Governance

This constitution supersedes all other development practices and coding guidelines. All pull 
requests MUST be reviewed for constitutional compliance before merge approval. Technical 
decisions that deviate from these principles MUST be documented with architectural decision 
records (ADRs) and approved by senior engineering staff.

Amendment procedure: Constitutional changes require consensus from engineering team leads, 
documentation of impact analysis, and migration plan for existing code where applicable.

**Version**: 1.0.0 | **Ratified**: 2025-10-02 | **Last Amended**: 2025-10-02